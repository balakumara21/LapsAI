@page "/"
@using LapsAI.Shared.Services
@inject IAPIGateway _APIGateway
@inject StorageService storageService
@inject NavigationManager navigationManager
@layout LoginLayout

<h3>LapsAI Login</h3>

<section class="vh-100">
    <div class="container-fluid h-custom">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-9 col-lg-6 col-xl-5">
                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-login-form/draw2.webp"
                     class="img-fluid" alt="Sample image">
            </div>
            <div class="col-md-8 col-lg-6 col-xl-4 offset-xl-1">
                <form>
                  


                    <!-- Username input -->
                    <div data-mdb-input-init class="form-outline mb-4">
                        <label class="form-label" for="form3Example3">Username</label>
                        <input type="text" id="form3Example3" class="form-control form-control-lg"
                               @bind="Username" placeholder="Enter Username" />
                        
                    </div>

                    <!-- Password input -->
                    <div data-mdb-input-init class="form-outline mb-3">
                        <label class="form-label" for="form3Example4">Password</label>
                        <input type="password" id="form3Example4" class="form-control form-control-lg"
                               @bind="Password" placeholder="Enter Password" />
                        
                    </div>

                   

                    <div class="text-center text-lg-start mt-4 pt-2">
                        <button type="button" @onclick="LoginEntry" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-lg"
                                style="padding-left: 2.5rem; padding-right: 2.5rem;">
                            Login
                        </button>
                        <p class="small fw-bold mt-2 pt-1 mb-0">
                            Don't have an account? <a href="#!"
                                                      class="link-danger">Register</a>
                        </p>
                    </div>

                </form>
            </div>
        </div>
    </div>
    <div class="d-flex flex-column flex-md-row text-center text-md-start justify-content-between py-4 px-4 px-xl-5 bg-primary" style="margin-top:50px">
        <!-- Copyright -->
        <div class="text-white mb-3 mb-md-0">
            Copyright © 2025. All rights reserved.
        </div>
        <!-- Copyright -->
      
    </div>
</section>

@code {
    string Username = string.Empty;
    string Password = string.Empty;

    private async Task LoginEntry()
    {
        var userinfo = new LapsAIDAO.Models.UserInfo { Username = Username, Password = Password };
        var result = await _APIGateway.postloginData(userinfo);
         if (result)
         {
            var Token = await _APIGateway.GetToken(userinfo);

             await storageService.Set("Token", Token);

            TokenStore.Token = Token;

            navigationManager.NavigateTo("/Home");

         }
         else
         {
             navigationManager.NavigateTo("/NotFound");
         }
    }
}
